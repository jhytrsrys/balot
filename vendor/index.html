<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Offline Balot Vendor App</title>
<style>
  :root {
  --accent: #007bff;
  --bg: #f8f9fa;
  --card: #ffffff;
  --muted: #555;
}

body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: #222;
  margin: 0;
  padding: 12px;
  min-height: 100vh;
  font-size: 18px;
  line-height: 1.6;
}

.app {
  max-width: 900px;
  margin: 0 auto;
}

header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
  flex-wrap: wrap;
  gap: 10px;
}

h1 {
  font-size: 24px;
  margin: 0;
}

.sub {
  color: var(--muted);
  font-size: 15px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 12px;
}

.card {
  background: var(--card);
  padding: 14px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.product-btn {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
  border-radius: 12px;
  border: 2px solid #ddd;
  cursor: pointer;
  font-size: 18px;
}

.product-btn:active {
  transform: scale(.98);
}

.product-name {
  font-weight: 700;
  font-size: 20px;
}

.small {
  font-size: 15px;
  color: var(--muted);
}

.controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

button, .btn {
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 700;
  font-size: 16px;
}

.btn.secondary {
  background: #e9ecef;
  border: 1px solid #ccc;
  color: #333;
}

.row {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

.summary {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.tile {
  padding: 12px;
  border-radius: 12px;
  background: #f1f3f5;
  min-width: 140px;
}

.cart-list {
  max-height: 200px;
  overflow: auto;
  margin-top: 8px;
  font-size: 16px;
}

input[type=number], input[type=text] {
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  background: #fff;
  color: #222;
  font-size: 16px;
}

.footer {
  margin-top: 16px;
  color: var(--muted);
  font-size: 14px;
}

/* ðŸ“± Mobile Responsiveness */
@media (max-width: 768px) {
  .grid {
    grid-template-columns: 1fr; /* Single column sa mobile */
  }

  header {
    flex-direction: column;
    align-items: flex-start;
  }

  h1 {
    font-size: 22px;
  }

  .product-btn {
    font-size: 16px;
    padding: 10px;
  }

  .product-name {
    font-size: 18px;
  }

  button, .btn {
    width: 100%; /* Full width buttons sa maliit na screen */
    padding: 12px;
    font-size: 18px;
  }

  .row {
    flex-direction: column;
    align-items: stretch;
  }

  .tile {
    width: 100%;
  }

  .cart-list {
    max-height: 150px;
    font-size: 15px;
  }
}

@media (max-width: 480px) {
  body {
    font-size: 16px;
    padding: 8px;
  }

  h1 {
    font-size: 20px;
  }

  .product-btn {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }

  .summary {
    flex-direction: column;
  }
}

</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Balot Vendor (Offline)</h1>
      <div class="sub">Quick sales, stock tracking & daily summary â€” walang internet required</div>
    </div>
    <div class="row">
      <button id="btnSettings" class="btn secondary">Settings</button>
      <button id="btnExport" class="btn">Backup</button>
    </div>
  </header>

  <section class="grid" id="productsGrid">
    <!-- Product buttons generated by JS -->
  </section>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div style="font-weight:800">Cart / Current Order</div>
        <div class="small muted">Use cart for multi-item orders (ex: 3 balot + 1 drink)</div>
      </div>
      <div class="row">
        <button id="toggleCart" class="btn secondary">Toggle Cart Mode</button>
        <button id="undoSale" class="btn secondary">Undo Last</button>
        <button id="clearDay" class="btn secondary">Reset Day</button>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div style="flex:1">
        <div class="cart-list card" id="cartList" style="background:transparent;padding:8px"></div>
      </div>
      <div style="width:240px">
        <div class="tile">
          <div style="font-weight:700">Today's Summary</div>
          <div style="margin-top:8px">
            <div class="small">Total Sales:</div>
            <div id="totalSales" style="font-size:20px;font-weight:800">0 pcs</div>
            <div class="small" style="margin-top:8px">Earnings:</div>
            <div id="earnings" style="font-size:20px;font-weight:800">â‚±0.00</div>
            <hr style="border:none;border-top:1px solid rgba(255,255,255,.03);margin:8px 0">
            <div class="small">Stock Remaining:</div>
            <div id="stockRemaining" style="font-weight:700">â€”</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:800">Quick Settings</div>
        <div class="small muted">Set starting stock and prices</div>
      </div>
      <div class="row">
        <button id="btnAddProduct" class="btn secondary">Add Product</button>
        <button id="btnLoadDemo" class="btn">Load Demo</button>
      </div>
    </div>

    <div id="settingsArea" style="margin-top:10px;display:none">
      <div id="settingsList"></div>
      <div style="margin-top:8px" class="row">
        <input id="newName" type="text" placeholder="Product name (e.g., Balot)" />
        <input id="newPrice" type="number" placeholder="Price â‚±" />
        <input id="newStock" type="number" placeholder="Stock" />
        <button id="saveNew" class="btn">Save</button>
      </div>
    </div>
  </div>

  <div class="footer">
    <div>Tip: Tap a product to sell 1. Hold Shift + click to sell 5 quickly (or use cart).</div>
  </div>
</div>

<script>
/*
  Offline Balot Vendor App (single-file)
  - persistent state via localStorage under key "balot_vendor_state_v1"
  - tiny service worker registered from a blob for offline caching
*/

const STORAGE_KEY = 'balot_vendor_state_v1';
let state = {
  products: [
    // defaults (can be changed)
    { id: 'balot', name: 'Balot', price: 16, stock: 100, sold: 0 },
    { id: 'penoy', name: 'Penoy', price: 15, stock: 50, sold: 0 },
    { id: 'sisiw', name: 'Sisiw', price: 20, stock: 30, sold: 0 },
    { id: 'drink', name: 'Softdrink', price: 25, stock: 40, sold: 0 }
  ],
  cartMode: false,
  cart: {},
  history: [] // {productId, qty, timestamp}
};

function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); renderAll(); }
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){ const parsed = JSON.parse(raw); Object.assign(state, parsed); }
  }catch(e){ console.error('loadState', e); }
}
function resetDay(){
  state.products.forEach(p=>{ p.sold = 0; });
  state.cart = {}; state.history = [];
  saveState();
}
function addProduct(name, price=10, stock=50){
  const id = name.trim().toLowerCase().replace(/\s+/g,'_') + '_' + Math.random().toString(36).slice(2,6);
  state.products.push({id, name, price: Number(price), stock: Number(stock), sold: 0});
  saveState();
}
function sell(productId, qty=1){
  const p = state.products.find(x=>x.id===productId);
  if(!p) return;
  if(p.stock - p.sold < qty){
    alert('Not enough stock for ' + p.name);
    return;
  }
  p.sold += qty;
  state.history.push({productId, qty, ts: Date.now()});
  saveState();
}
function undoLast(){
  const last = state.history.pop();
  if(!last){ alert('No history to undo'); return; }
  const p = state.products.find(x=>x.id===last.productId);
  if(p){ p.sold = Math.max(0, p.sold - last.qty); }
  saveState();
}
function addToCart(productId, qty=1){
  state.cart[productId] = (state.cart[productId]||0) + qty;
  saveState();
}
function clearCart(){
  state.cart = {}; saveState();
}
function checkoutCart(){
  const entries = Object.entries(state.cart);
  if(entries.length === 0){ alert('Cart is empty'); return; }
  // validate stock
  for(const [pid,qty] of entries){
    const p = state.products.find(x=>x.id===pid);
    if(!p || (p.stock - p.sold) < qty){ alert('Not enough stock for ' + (p?p.name:pid)); return; }
  }
  for(const [pid,qty] of entries){
    sell(pid, qty);
  }
  clearCart();
  alert('Order recorded');
}
function totalSalesCount(){
  return state.products.reduce((s,p)=>s+p.sold,0);
}
function totalEarnings(){
  return state.products.reduce((s,p)=>s + (p.sold * p.price),0);
}
function totalStockRemaining(){
  return state.products.map(p=>`${p.name}: ${Math.max(0,p.stock - p.sold)} pcs`).join(' â€¢ ');
}

/* UI rendering */
const productsGrid = document.getElementById('productsGrid');
const cartList = document.getElementById('cartList');
const totalSalesEl = document.getElementById('totalSales');
const earningsEl = document.getElementById('earnings');
const stockRemainingEl = document.getElementById('stockRemaining');
const settingsArea = document.getElementById('settingsArea');
const settingsList = document.getElementById('settingsList');

function renderProducts(){
  productsGrid.innerHTML = '';
  state.products.forEach(p=>{
    const btn = document.createElement('div');
    btn.className='card product-btn';
    btn.innerHTML = `
      <div>
        <div class="product-name">${p.name}</div>
        <div class="small">â‚±${Number(p.price).toFixed(2)} â€¢ left: <span class="stock">${Math.max(0,p.stock - p.sold)}</span></div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:800">${p.sold} sold</div>
        <div class="small muted">Tap to sell</div>
      </div>
    `;
    btn.addEventListener('click', (ev)=>{
      // shift-click quicksell
      const qty = ev.shiftKey ? 5 : 1;
      if(state.cartMode){
        addToCart(p.id, qty);
      } else {
        sell(p.id, qty);
      }
    });
    // right-click to show details / edit name/price/stock
    btn.addEventListener('contextmenu', (e)=>{
      e.preventDefault();
      const newName = prompt('Edit product name', p.name);
      if(newName === null) return;
      const newPrice = prompt('Price â‚±', p.price);
      const newStock = prompt('Stock', p.stock);
      p.name = newName || p.name;
      p.price = Number(newPrice) || p.price;
      p.stock = Number(newStock) || p.stock;
      saveState();
    });
    productsGrid.appendChild(btn);
  });
}

function renderCart(){
  cartList.innerHTML = '';
  const keys = Object.keys(state.cart);
  if(keys.length === 0){
    cartList.innerHTML = '<div class="small muted">Cart is empty</div>';
    return;
  }
  keys.forEach(pid=>{
    const p = state.products.find(x=>x.id===pid);
    const qty = state.cart[pid];
    const row = document.createElement('div');
    row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='6px 0';
    row.innerHTML = `<div><strong>${p? p.name:pid}</strong><div class="small">â‚±${p?p.price.toFixed(2):'0'}</div></div>
                     <div class="row">
                       <button class="btn secondary" data-action="dec">-</button>
                       <div style="width:36px;text-align:center">${qty}</div>
                       <button class="btn secondary" data-action="inc">+</button>
                       <button class="btn" data-action="remove">Checkout</button>
                     </div>`;
    row.querySelector('[data-action="inc"]').onclick = ()=>{ addToCart(pid,1); };
    row.querySelector('[data-action="dec"]').onclick = ()=>{ if(state.cart[pid]>1) { state.cart[pid]--; saveState(); } else { delete state.cart[pid]; saveState(); } };
    row.querySelector('[data-action="remove"]').onclick = ()=>{ 
      // checkout this item only
      if(confirm(`Record sale: ${qty} x ${p.name}?`)){
        if((p.stock - p.sold) < qty){ alert('Not enough stock'); return; }
        sell(pid, qty);
        delete state.cart[pid];
        saveState();
      }
    };
    cartList.appendChild(row);
  });
  // checkout all
  const checkoutBtn = document.createElement('div');
  checkoutBtn.style.marginTop='8px';
  checkoutBtn.innerHTML = `<button id="checkoutAll" class="btn">Checkout All</button>`;
  cartList.appendChild(checkoutBtn);
  document.getElementById('checkoutAll').onclick = ()=>{ if(confirm('Confirm checkout of entire cart?')) checkoutCart(); };
}

function renderSummary(){
  totalSalesEl.textContent = totalSalesCount() + ' pcs';
  earningsEl.textContent = 'â‚±' + totalEarnings().toFixed(2);
  stockRemainingEl.textContent = totalStockRemaining();
}

function renderSettings(){
  settingsList.innerHTML = '';
  state.products.forEach(p=>{
    const div = document.createElement('div');
    div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.padding='6px 0';
    div.innerHTML = `<div>
      <div style="font-weight:700">${p.name}</div>
      <div class="small muted">Price: â‚±${p.price} â€¢ Stock: ${p.stock} â€¢ Sold: ${p.sold}</div>
    </div>
    <div class="row">
      <button class="btn secondary" data-id="${p.id}" data-act="setstock">Set Stock</button>
      <button class="btn secondary" data-id="${p.id}" data-act="setprice">Set Price</button>
      <button class="btn secondary" data-id="${p.id}" data-act="delete">Delete</button>
    </div>`;
    settingsList.appendChild(div);
  });
  settingsList.querySelectorAll('button').forEach(b=>{
    b.onclick = ()=>{
      const id = b.dataset.id;
      const act = b.dataset.act;
      const p = state.products.find(x=>x.id===id);
      if(!p) return;
      if(act==='setstock'){
        const ns = prompt('New stock for ' + p.name, p.stock);
        if(ns!==null) { p.stock = Number(ns)||0; saveState(); }
      } else if(act==='setprice'){
        const np = prompt('New price â‚± for ' + p.name, p.price);
        if(np!==null){ p.price = Number(np)||p.price; saveState(); }
      } else if(act==='delete'){
        if(confirm('Delete product ' + p.name + '?')){ state.products = state.products.filter(x=>x.id!==id); saveState(); }
      }
    };
  });
}

function renderAll(){
  renderProducts();
  renderCart();
  renderSummary();
  renderSettings();
}

/* Controls */
document.getElementById('toggleCart').onclick = ()=>{
  state.cartMode = !state.cartMode; saveState();
  document.getElementById('toggleCart').textContent = state.cartMode? 'Cart Mode: ON' : 'Toggle Cart Mode';
};
document.getElementById('undoSale').onclick = ()=>{ undoLast(); };
document.getElementById('clearDay').onclick = ()=>{ if(confirm('Reset day? This will clear sold counts and history.')) resetDay(); };

document.getElementById('btnSettings').onclick = ()=>{ settingsArea.style.display = settingsArea.style.display === 'none' ? 'block' : 'none'; };
document.getElementById('btnAddProduct').onclick = ()=>{ settingsArea.style.display='block'; document.getElementById('newName').focus(); };
document.getElementById('saveNew').onclick = ()=>{
  const name = document.getElementById('newName').value.trim();
  const price = Number(document.getElementById('newPrice').value) || 0;
  const stock = Number(document.getElementById('newStock').value) || 0;
  if(!name){ alert('Enter product name'); return; }
  addProduct(name, price, stock);
  document.getElementById('newName').value=''; document.getElementById('newPrice').value=''; document.getElementById('newStock').value='';
};
document.getElementById('btnLoadDemo').onclick = ()=>{ if(confirm('Load demo default products (will overwrite existing)?')){ state.products=[{id:'balot',name:'Balot',price:16,stock:100,sold:0},{id:'penoy',name:'Penoy',price:15,stock:50,sold:0},{id:'sisiw',name:'Sisiw',price:20,stock:30,sold:0},{id:'drink',name:'Softdrink',price:25,stock:40,sold:0}]; saveState(); }};

document.getElementById('btnExport').onclick = ()=>{
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'balot_backup_' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  URL.revokeObjectURL(url);
};

/* import on paste (quick) */
window.addEventListener('paste', (e)=>{
  try{
    const txt = (e.clipboardData || window.clipboardData).getData('text');
    if(!txt) return;
    const parsed = JSON.parse(txt);
    if(parsed && parsed.products){
      if(confirm('Import pasted backup? This will replace current state.')){ state = parsed; saveState(); }
    }
  }catch(err){}
});

/* init */
loadState();
renderAll();

/* lightweight service worker registration from a blob so app caches itself (works after first load) */
if('serviceWorker' in navigator){
  const swCode = `
    const CACHE = 'balot-vendor-cache-v1';
    const offlineResponse = new Response('<!doctype html><meta charset="utf-8"><title>Offline</title><style>body{background:#07121a;color:#fff;font-family:system-ui;padding:20px}</style><h1>Balot App (Offline)</h1><p>This app is offline but works locally. Return to the app.</p></body>', {headers: {'Content-Type': 'text/html'}});
    self.addEventListener('install', e => {
      self.skipWaiting();
      e.waitUntil(
        caches.open(CACHE).then(cache => cache.addAll(['/', location.pathname]))
      );
    });
    self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
    self.addEventListener('fetch', e => {
      if(e.request.method !== 'GET') return;
      e.respondWith(
        caches.match(e.request).then(r => r || fetch(e.request).catch(()=>offlineResponse))
      );
    });
  `;
  const blob = new Blob([swCode], {type:'application/javascript'});
  const swUrl = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swUrl).then(()=>console.log('SW registered from blob')).catch(()=>console.log('SW register failed'));
}
</script>
</body>
</html>
